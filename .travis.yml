language: generic # see https://medium.com/@desfocado/how-to-get-travis-to-work-with-no-build-language-9f4c03ed68b1

services:
  - docker

env:
  - DOCKER_APP_DB_USERNAME=erogatio DOCKER_APP_DB_PASSWORD=password DOCKER_POSTGRES_PASSWORD=sekrit

install:
  - /bin/true

before_script:
  - mkdir .pgdata
  - docker-compose up --build -d
  - docker-compose exec web bundle install
  - docker-compose exec -e RAILS_ENV=test -e TRAVIS=true web bundle exec rake db:create db:test:prepare

script:
  - docker-compose exec web bundle exec rspec
  - docker-compose exec web bundle exec cucumber
